model<-Arima(test_ts,model=model,xreg=xreg_test) # do not train, use current model with new observations
}
test_pred[i+1,]<-forecast(model,h=hor)$mean # predict new values
setTxtProgressBar(pb, i) # update progress
}
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
test_pred
is.data.frame(test_pred)
i=0
test_ts<-ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
model<-auto.arima(test_ts,xreg=xreg_test) # find best model on the current train set
test_pred[i+1,]<-forecast(model,h=hor)$mean # predict new values
test_pred
test_pred[i,]<-forecast(model,h=hor)$mean # predict new values
test_pred
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
test_pred[i,]<-forecast(model,h=hor)$mean # predict new values
test_pred
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
train
train$date
rownames(train)
as.factor(year(rownames(train))
)
rbind(rownames(train),rownames(test))
rownames(train)
rownames(test)
?rbind
cbind(rownames(train),rownames(test))
c(rownames(train),rownames(test))
max.print
getOption(max.print)
getOption('max.print')
setOption('max.print')=1500
option(max.print=1500)
?option
options(max.print=1500)
c(rownames(train),rownames(test))
dummy_year=model.matrix(~as.factor(year(c(rownames(train),rownames(test)))))
dummy_year
year(c(rownames(train),rownames(test)))
as.factor(year(c(rownames(train),rownames(test))))
?factor
?~
dummy_year=model.matrix(~as.factor(year(c(rownames(train),rownames(test)))))
dummy_year[1]
dummy_year[,1]
dummy_year[,2]
dummy_year[,3]
dummy_year[,4]
dummy_year[,5]
dummy_year[,1]
?model.matrix
dummy_year[,6]
dummy_year[,5]
dummy_year[,0]
as.factor(year(c(rownames(train),rownames(test)))
)
dummy_year[,1]
?fourier
?msts
5/2
5//2
5%2
5%/%2
?expand.grid
?combn
combn(5,2)
?expand.grid
?expand.grid(1:5,1:3)
expand.grid(1:5,1:3)
K=list(5,8)
expand.grid(K)
expand.grid(unlist(K)
)
unlist(K)
unlist(K)%/%2
1:unlist(K)%/%2
?apply
?:
lapply(K%/%2
)
lapply(K%/%2,seq,from=1)
K%/%2
K
K=list(5,8)
K%/%2
lapply(K,function(x) seq(from,x%/%2),from=1)
lapply(K,function(x) seq(from=1,x%/%2),from=1)
?se
?seq
lapply(K,function(x) seq(x%/%2))
expand.grid(lapply(K,function(x) seq(x%/%2)))
K=list(5,8,6)
expand.grid(lapply(K,function(x) seq(x%/%2)))
?dlply
?by
expand.grid(lapply(K,function(x) seq(0,x%/%2)))
?fourier
params=expand.grid(lapply(K,function(x) seq(0,x%/%2))) # all combinations of fourier orders
nrow(params
)
?fourier
library(forecast)
library(lubridate)
?fourier
fourier_order<-function(train,freqs){
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
}
return(param_best)
}
dir<-'C:/Users/SABA/Google Drive/mtsg/data/' # directory containing data
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
train
ts(c(t(train)),frequency = freq)
fourier_order<-function(train,freq,freqs){
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
print(aicc_best)
}
}
return(param_best)
}
fourier_order(train,freq=24,freqs=c(7,365.25))
freq=7
freq=24
freqs=c(7*24,365.25*24)
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
params
?expand.grid
expand.grid(height = seq(60, 80, 5), weight = seq(100, 300, 50),
sex = c("Male","Female"))
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
max_order=10
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
i=0
unlist(params[i,])
unlist(params[0,])
unlist(params[1,])
unlist(params[20,])
param<-unlist(params[i,]) # combination of orders
i=1
param<-unlist(params[i,]) # combination of orders
is.list(param)
is.vector(param)
freqs=c(7*24,365.25*24)
freqs
is.vector(freqs)
?apply
?vapply
?sapply
?expand.grid
params<-expand.grid(apply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params<-expand.grid(sapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params
is.vector(freqs)
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
param<-unlist(params[i,]) # combination of orders
?fourier
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
param
i
param<-unlist(params[i,]) # combination of orders
param
params
sapply(freqs,function(x) seq(0,max_order))
lapply(freqs,function(x) seq(0,max_order))
vapply(freqs,function(x) seq(0,max_order))
lapply(freqs,function(x) seq(0,max_order))
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
param<-unlist(params[i,]) # combination of orders
param
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
xreg_train
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
seq(max_order)
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
fourier_order<-function(train,freq,freqs,max_order){
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
print(param)
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
}
return(param_best)
}
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
max_order
max_order=2
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
i=1
param<-unlist(params[i,]) # combination of orders
print(param)
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
?auto.arima
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE,trace=TRUE) # find best arima model
fit
?auto.arima
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE,trace=TRUE) # find best arima model
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,stepwise=FALSE,trace=TRUE) # find best arima model
fit
arimaorder(fit)
fourier_order(train,freq=7,freqs=c(7*24,365.25*24,max_order=10))
fourier_order(train,freq=7,freqs=c(7*24,365.25*24),max_order=10)
fourier_order<-function(train,freq,freqs,max_order){
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
print(param)
print(fit$aicc)
}
return(param_best)
}
fourier_order(train,freq=7,freqs=c(7*24,365.25*24),max_order=10)
K=fourier_order(train,freq=24,freqs=c(7*24,365.25*24),max_order=10)
temp_train<-read.csv(paste(dir,'train_tempm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load temperatures for train set
temp_test<-read.csv(paste(dir,'test_tempm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load temperatures for test set
hum_train<-read.csv(paste(dir,'train_hum.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load humidities for train set
hum_test<-read.csv(paste(dir,'test_hum.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load humidities for test set
wspd_train<-read.csv(paste(dir,'train_wspdm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load wind speeds for train set
wspd_test<-read.csv(paste(dir,'test_wspdm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load wind speeds for test set
prsr_train<-read.csv(paste(dir,'train_pressurem.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load pressures for train set
prsr_test<-read.csv(paste(dir,'test_pressurem.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load pressures for test set
temp_test
c(t(temp_test))
xregs=list(temp_train,hum_train,wspd_train,prsr_train)
xregs
wxreg_train<-cbind(lapply(xregs,c(t(x)))) # format and combine weather regressors
wxreg_train<-cbind(lapply(xregs,function(x) c(t(x)))) # format and combine weather regressors
data.frame(holiday=rep(FALSE,30))
0:5
wxreg_train
xreg
wxreg_train
xreg<-cbind(lapply(wxreg_train,function(x) c(t(x)))) # format and combine weather regressors for train set
xreg
?lapply
xreg.ismatrix()
xreg.is.matrix()
?is.matrix
xreg.is.matrix
is.matrix(xreg)
xreg[1,]
?do.call
?matrix
do.call(lapply(wxreg_train,function(x) c(t(x))))
?do.call
do.call(cbind,lapply(wxreg_train,function(x) c(t(x))))
xregs=list(temp_train,hum_train,wspd_train,prsr_train)
wxreg_train<-do.call(cbind,lapply(regs,function(x) c(t(x)))) # format and combine weather regressors for train set
wxreg_train<-do.call(cbind,lapply(xregs,function(x) c(t(x)))) # format and combine weather regressors for train set
wxreg_train
wxreg_train[1,]
wxreg_train[:10,]
wxreg_train[1:10,]
test
head(test,10)
test[1:10,]
test[1:0,]
test[1:1,]
1:0
1:0:1
?seq
head(test,0)
head[1:1]
head[1:0]
test[1:0,]
test[0:0,]
test[0:1,]
test[1:1,]
test[1:1,]
1:1
test[1:1,]
0:0
0:1
0:10:2
0:2:10
?seq
seq(0,10,2)
test
c(t(test))
nrow(c(t(test)))
len(c(t(test)))
NROW(c(t(test)))
length(c(t(test)))
8688/24
seq(0,8677,24)
seq(0,8688,24)
seq(0,8688-24,24)
seq(0,8688-1,24)
?seq
?length.out
?seq_len
seq(0,8688-24,24)
seq_len(0)
test
test[seq_len(0)]
test[0]
test[1]
test
c(t(test))[seq_len(0)]
c(t(test))[seq_len(1)]
c(t(test))[seq_len(2)]
c(t(test))[seq_len(24)]
c(t(test))[seq_len(24),]
seq_len(24)
seq_len(24)+24
cbind(NULL,NULL)
cbind(NULL,5)
?cbind
rbind(c(t(train)),c(t(test)))
c(c(t(train)),c(t(test)))
ts(c(c(t(train)),c(t(test))),grequency=24)
ts(c(c(t(train)),c(t(test))),frequency=24)
c(c(t(train)),c(t(test)))
train
length(train)
nrows(train)
nrow(train)
1078*24
train[1078,]
test[1,]
c(c(t(train)),c(t(test)))[(25872-24):25872+24]
c(c(t(train)),c(t(test)))[(25872-24):(25872+24)]
train[1077,]
c(c(t(train)),c(t(test))[seq_len(0)])
c(t(train))
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
temp_train<-read.csv(paste(dir,'train_tempm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load temperatures for train set
temp_test<-read.csv(paste(dir,'test_tempm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load temperatures for test set
hum_train<-read.csv(paste(dir,'train_hum.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load humidities for train set
hum_test<-read.csv(paste(dir,'test_hum.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load humidities for test set
wspd_train<-read.csv(paste(dir,'train_wspdm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load wind speeds for train set
wspd_test<-read.csv(paste(dir,'test_wspdm.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load wind speeds for test set
prsr_train<-read.csv(paste(dir,'train_pressurem.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load pressures for train set
prsr_test<-read.csv(paste(dir,'test_pressurem.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load pressures for test set
xregs=list(temp_train,hum_train,wspd_train,prsr_train)
xregs_test=list(temp_test,hum_test,wspd_test,prsr_test)
K=c(10,6)
wxreg_train=list(temp_train,hum_train,wspd_train,prsr_train)
wxreg_test=list(temp_test,hum_test,wspd_test,prsr_test)
K=c(10,6)
batch=28
freq=24
f_K=K
wxreg_train=wxreg_train
wxreg_test=wxreg_train
train<-c(t(train)) # flatten train set
test<-c(t(test)) # flatten test set
is.null(f_K)
if (is.null(f_K)){ # not considering multiple seasonalities
fxreg_train<-NULL
fxreg_test<-NULL
}
else { # considering multiple seasonalities
fxreg_train<-fourier(msts(train,seasonal.periods=freqs),K=f_K)
fxreg_test<-fourier(msts(test,seasonal.periods=freqs),K=f_K)
}
fxreg_train<-fourier(msts(train,seasonal.periods=freqs),K=f_K)
library(forecast)
library(lubridate)
fxreg_train<-fourier(msts(train,seasonal.periods=freqs),K=f_K)
fxreg_test<-fourier(msts(test,seasonal.periods=freqs),K=f_K)
is.null(wxreg_train)|is.null(wxreg_test)
wxreg_train<-do.call(cbind,lapply(wxreg_train,function(x) c(t(x)))) # flatten and combine weather regressors for train set
wxreg_test<-do.call(cbind,lapply(wxreg_test,function(x) c(t(x)))) # flatten and combine weather regressors for test set
wxreg_train=list(temp_train,hum_train,wspd_train,prsr_train)
wxreg_test=list(temp_test,hum_test,wspd_test,prsr_test)
wxreg_train_c<-do.call(cbind,lapply(wxreg_train,function(x) c(t(x)))) # flatten and combine weather regressors for train set
wxreg_test_c<-do.call(cbind,lapply(wxreg_test,function(x) c(t(x)))) # flatten and combine weather regressors for test set
wxreg_train<-do.call(cbind,lapply(wxreg_train,function(x) c(t(x)))) # flatten and combine weather regressors for train set
wxreg_test<-do.call(cbind,lapply(wxreg_test,function(x) c(t(x)))) # flatten and combine weather regressors for test set
xreg_train<-cbind(fxreg_train,wxreg_train) # combine fourier & weather into one matrix for train set
xreg_test<-cbind(fxreg_test,wxreg_test) # combine fourier & weather into one matrix for test set
dim(fxreg_train)
dim(fxreg_test)
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
train<-c(t(train)) # flatten train set
test<-c(t(test)) # flatten test set
seq(0,length(test)-h,h)
h
seq(0,length(test)-hor,hor)
i=0
train_ts<-ts(c(train,test[seq_len(i)]),frequency=freq) # add new observations from test set to the current train set
!is.null(xreg_train)&!is.null(xreg_test)
i%%batch==0
xreg=NULL # default covariances
model<-auto.arima(train_ts,xreg=xreg) # find best model on the current train set
?Arima
model<-auto.arima(train_ts,xreg=xreg,seasonal=FALSE,parallel = TRUE,stepwise=FALSE) # find best model on the current train set
xreg
xreg<-rbind(xreg_train,xreg_test[seq_len(i),]) # add covariates corresponding to new observations
xreg_pred<-xreg_test[i+seq_len(hor),] # add covariates for predictions
model<-auto.arima(train_ts,xreg=xreg,seasonal=FALSE,parallel = TRUE,stepwise=FALSE) # find best model on the current train set
test_list=list(list(a=1,b=2),list(a=3,b=4))
sapply(test_list,`[[`,"a")
sapply(test_list,X = `,"a")
sapply(test_list,`$`,"a")
sapply(test_list,`[[`,"a")
lapply(wxreg_train,`[[`,0)
lapply(wxreg_train,`[[`,1)
colnames(wxreg_train)
names(wxreg_train)
wxreg_train=list(temp_train,hum_train,wspd_train,prsr_train)
names(wxreg_train)
names(train)
train
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
names(train)
lapply(wxreg_train,`[[`,"X0")
test_list<-lapply(wxreg_train,`[[`,"X0")
test_list[1]
is.data.frame(test_list[1])
is.vector(test_list[1])
test_list<-lapply(wxreg_train,function(x) as.data.frame(`[[`,x),"X0")
train
`[[` train 'X0'
`[[`(train, 'X0')
test_list<-lapply(wxreg_train,function(x) as.data.frame(`[[`(x,'X0')))
test_list
wxreg_train
wxreg_train<-lapply(wxreg_train,function(x) as.data.frame(`[[`(x, col))) # extract a particular column from each member of list of covariates
names(train)
wxreg_train<-lapply(wxreg_train,function(x) as.data.frame(`[[`(x, 'X0'))) # extract a particular column from each member of list of covariates
wxreg_train<-do.call(cbind,lapply(wxreg_train,function(x) c(t(x)))) # flatten and combine weather regressors for train set
View(wxreg_train)
nrows(train)
nrow(train)
load<-function(path){
data<-read.csv(path,header=TRUE,row.names='date',sep=',',dec='.') # load data
return(data)
}
train<-load(paste(dir,'train.csv', sep='')) # load train set
train
wxregs_train<-lapply(list('train_tempm.csv','train_hum.csv','train_wspdm.csv','train_pressurem.csv'),function(x) load(paste(dir,x,sep='')))
wxregs_test<-lapply(list('test_tempm.csv','test_hum.csv','test_wspdm.csv','test_pressurem.csv'),function(x) load(paste(dir,x,sep='')))
train<-load(paste(dir,'train.csv', sep='')) # load train set
test<-load(paste(dir,'test.csv', sep='')) # load test set
library(forecast)
library(lubridate)
K<-f_ords(train,freq=24,freqs=c(24*7,365.25*7),max_order=10) # find best fourier coefficients
f_ords<-function(train,freq=24,freqs,max_order){
train<-c(t(train)) # flatten train set
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(train,frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
print(param)
print(fit$aicc)
}
return(param_best)
}
K<-f_ords(train,freq=24,freqs=c(24*7,365.25*7),max_order=10) # find best fourier coefficients
K
