for (i in 0:6){ # for each day
train=read.csv(paste(dir,'train_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
test=read.csv(paste(dir,'test_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load test set
date_train=train$date # extract date column from train set
date_test=test$date # extract date column from test set
train=train[ , !names(train) %in% c('date')] # drop date column from train set
test=test[ , !names(test) %in% c('date')] # drop date column from test set
test_pred_hw=arima_h(train,test,batch=4,freq=24) # horizontal predictions for this day
rownames(test_pred_hw)=date_test # set "index"
write.csv(test_pred_hw,file=paste(dir,'arima_rh_',i,'.csv',sep='')) # write results
}
arima=function(train,test,hor=1,batch=7,freq=7){
test_pred=matrix(data=NA,nrow=nrow(test),ncol=ncol(test)) # initialize matrix for predictions
pb=txtProgressBar(min = 0, max = nrow(test), style = 3) # initialize progress bar
for (i in 0:nrow(test)){ # for each sample in test set
test_ts=ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
if (i%%batch==0){ # # if its time to retrain
model=auto.arima(test_ts) # find best model on the current train set
}
else{ # it is not the time to retrain
model=Arima(test_ts,model=model) # do not train, use current model with new observations
}
test_pred[i,]=forecast(model,h=hor)$mean # predict new values
setTxtProgressBar(pb, i) # update progress
}
close(pb) # close progress bar
return(data.frame(test_pred))
}
arima_h=function(train,test,batch=7,freq=24){
return(arima(train,test,hor=24,batch=batch,freq=freq))
}
arima_v=function(train,test,batch=7,freq=7){
test_pred=as.data.frame(lapply(test, function(x) rep.int(NA, length(x)))) # template dataframe for predictions
for (col in names(train)){
train_day=as.data.frame(train[[col]]) # convert dataframe column to dataframe
test_day=as.data.frame(test[[col]]) # convert dataframe column to dataframe
colnames(train_day)=c(col) # set column name to match
colnames(test_day)=c(col) # set column name to match
test_pred[[col]]=arima(train_day,test_day,hor=1,batch=batch,freq=freq) # predictions
}
return(test_pred)
}
for (i in 0:6){ # for each day
train=read.csv(paste(dir,'train_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
test=read.csv(paste(dir,'test_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load test set
date_train=train$date # extract date column from train set
date_test=test$date # extract date column from test set
train=train[ , !names(train) %in% c('date')] # drop date column from train set
test=test[ , !names(test) %in% c('date')] # drop date column from test set
test_pred_hw=arima_h(train,test,batch=4,freq=4) # horizontal predictions for this day
rownames(test_pred_hw)=date_test # set "index"
write.csv(test_pred_hw,file=paste(dir,'arima_rh_',i,'.csv',sep='')) # write results
}
for (i in 0:6){ # for each day
train=read.csv(paste(dir,'train_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
test=read.csv(paste(dir,'test_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load test set
date_train=train$date # extract date column from train set
date_test=test$date # extract date column from test set
train=train[ , !names(train) %in% c('date')] # drop date column from train set
test=test[ , !names(test) %in% c('date')] # drop date column from test set
test_pred_vw=arima_v(train,test,batch=4,freq=4) # horizontal predictions for this day
rownames(test_pred_vw)=date_test # set "index"
write.csv(test_pred_vw,file=paste(dir,'arima_rv_',i,'.csv',sep='')) # write results
}
test_pred_h=arima_h(train,test,batch=28,freq=24) # horizontal prediction
rownames(test_pred_h)=date_test # set "index"
write.csv(test_pred_h,file='C:/Users/SABA/Google Drive/mtsg/code/load_forecast/data/arima_rh.csv',quote = FALSE) # write predictions
test_pred_v=arima_v(train,test,batch=28,freq=7) # vertical predictions
rownames(test_pred_v)=date_test # set "index"
write.csv(test_pred_v,file='C:/Users/SABA/Google Drive/mtsg/code/load_forecast/data/arima_rv.csv') # write results
library(forecast)
arima=function(train,test,hor=1,batch=7,freq=7){
test_pred=matrix(data=NA,nrow=nrow(test),ncol=ncol(test)) # initialize matrix for predictions
pb=txtProgressBar(min = 0, max = nrow(test), style = 3) # initialize progress bar
for (i in 0:nrow(test)){ # for each sample in test set
test_ts=ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
if (i%%batch==0){ # # if its time to retrain
model=auto.arima(test_ts) # find best model on the current train set
}
else{ # it is not the time to retrain
model=Arima(test_ts,model=model) # do not train, use current model with new observations
}
test_pred[i,]=forecast(model,h=hor)$mean # predict new values
setTxtProgressBar(pb, i) # update progress
}
close(pb) # close progress bar
return(data.frame(test_pred))
}
arima_h=function(train,test,batch=7,freq=24){
return(arima(train,test,hor=24,batch=batch,freq=freq))
}
arima_v=function(train,test,batch=7,freq=7){
test_pred=as.data.frame(lapply(test, function(x) rep.int(NA, length(x)))) # template dataframe for predictions
for (col in names(train)){
train_day=as.data.frame(train[[col]]) # convert dataframe column to dataframe
test_day=as.data.frame(test[[col]]) # convert dataframe column to dataframe
colnames(train_day)=c(col) # set column name to match
colnames(test_day)=c(col) # set column name to match
test_pred[[col]]=arima(train_day,test_day,hor=1,batch=batch,freq=freq) # predictions
}
return(test_pred)
}
dir='C:/Users/SABA/Google Drive/mtsg/data/' # directory containing data
# horizontal predictions for each day separately
for (i in 0:6){ # for each day
train=read.csv(paste(dir,'train_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
test=read.csv(paste(dir,'test_',i,'.csv', sep=''),header=TRUE,sep=',',dec='.') # load test set
date_train=train$date # extract date column from train set
date_test=test$date # extract date column from test set
train=train[ , !names(train) %in% c('date')] # drop date column from train set
test=test[ , !names(test) %in% c('date')] # drop date column from test set
test_pred_hw=arima_h(train,test,batch=4,freq=24) # horizontal predictions for this day
rownames(test_pred_hw)=date_test # set "index"
write.csv(test_pred_hw,file=paste(dir,'arima_rh_',i,'.csv',sep='')) # write results
}
library(forecast)
set.seed(1)
library(lubridate)
install.packages('lubridate')
index <- ISOdatetime(2010,1,1,0,0,0)+1:8759*60*60
month <- month(index)
?month
index
month <- month(index)
library(lubridate)
month <- month(index)
hour <- hour(index)
usage <- 1000+10*rnorm(length(index))-25*(month-6)^2-(hour-12)^2
usage <- ts(usage,frequency=24)
xreg <- model.matrix(~as.factor(month))[,2:12]
xreg
model.matrix(~as.factor(month))
month
model.matrix(~as.factor(month))
xreg <- model.matrix(~as.factor(month))[,2:12]
xreg
xreg[1]
xreg[1,:]
xreg[1,]
xreg[,1]
xreg[1000:2000,2]
train
date_train
library(lubridate)
month(date_train)
?model.matrix
~as.factor(month(date_train))
as.factor(month(date_train))
i=0
test_ts=ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
freq=24
test_ts=ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
seasonaldummy(test_ts)
date_train
seasonaldummy(date_train)
seasonaldummy(ts(date_train,frequency=12))
seasonaldummy(ts(date_train,frequency=7))
as.factor(month(date_train))
model.matrix(~as.factor(month(date_train)))
model.matrix(~as.factor(month(date_train)))[1:11]
model.matrix(~as.factor(month(date_train)))[,1:11]
as.factor(year(date_train))
date_train
train=read.csv(paste(dir,'train.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
test=read.csv(paste(dir,'test.csv', sep=''),header=TRUE,sep=',',dec='.') # load test set
date_train=train$date # extract date column from train set
date_test=test$date # extract date column from test set
train=train[ , !names(train) %in% c('date')] # drop date column from train set
test=test[ , !names(test) %in% c('date')] # drop date column from test set
dir='C:/Users/SABA/Google Drive/mtsg/data/' # directory containing data
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,sep=',',dec='.') # load train set
date_train<-pop_col(train,col='date') # extract date column from train set
pop_col<-function(data,col){ # removes and returns column from dataframe
poped_col<-data$col # extract column from dataframe
data<<-data[ , !names(data) %in% c(col)] # drop column from dataframe & change the original dataframe
return(poped_col)
}
date_train<-pop_col(train,col='date') # extract date column from train set
pop_col<-function(dataframe,col){ # removes and returns column from dataframe
poped_col<-dataframe$col # extract column from dataframe
dataframe<<-dataframe[ , !names(dataframe) %in% c(col)] # drop column from dataframe & change the original dataframe
return(poped_col)
}
date_train<-pop_col(train,col='date') # extract date column from train set
date_train<-pop_col(train,col='date') # extract date column from train set
date_train<-pop_col(dataframe=train,col='date') # extract date column from train set
View(train)
train
rownames(train)=train$date
train
?read.csv
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,rownames='date',sep=',',dec='.') # load train set
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
train
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
hor=1
hor=24
batch=7
freq=7
test_pred<-matrix(data=NA,nrow=nrow(test),ncol=ncol(test)) # initialize matrix for predictions
i=0
test_ts<-ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
test_ts
model<-auto.arima(test_ts,xreg=xreg_ts) # find best model on the current train set
xreg_test=NULL
model<-auto.arima(test_ts,xreg=xreg_test) # find best model on the current train set
train
train[1]
ts(train[1],frequency=7)
test_pred
rownames(test_pred)=rownames(test)
test_pred
i
test_pred[i,]<-forecast(model,h=hor,)$mean # predict new values
test_pred
forecast(model,h=hor)$mean
test_pred[i,]<-forecast(model,h=hor)$mean # predict new values
test_pred
test_pred[0,]
test_pred[1,]
test_pred
test_pred[1,]<-forecast(model,h=hor)$mean # predict new values
test_pred
data.frame
?data.frame
train
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
hor=24
i=0
batch=7
freq=24
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test)),row.names=rownames(test)) # initialize matrix for predictions
test_pred
test
?matrix
?col.names
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test))) # initialize matrix for predictions
pb<-txtProgressBar(min = 0, max = nrow(test), style = 3) # initialize progress bar
for (i in 0:nrow(test)){ # for each sample in test set
test_ts<-ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
if (is.null(xreg)){ # not considering external regressors
xreg_ts<-xreg # preserve NULL
}
else{ # considering external regressors
xreg_ts<-ts.union(lapply(xreg,function(x,freq) ts(c(t(x)),frequency=freq),freq=freq)) # format and combine external regressors
}
if (i%%batch==0){ # # if its time to retrain
model<-auto.arima(test_ts,xreg=xreg_test) # find best model on the current train set
}
else{ # it is not the time to retrain
model<-Arima(test_ts,model=model,xreg=xreg_test) # do not train, use current model with new observations
}
test_pred[i+1,]<-forecast(model,h=hor)$mean # predict new values
setTxtProgressBar(pb, i) # update progress
}
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
test_pred
is.data.frame(test_pred)
i=0
test_ts<-ts(c(t(rbind(train,head(test,i)))),frequency=freq) # add a new day from test set to the current train set
model<-auto.arima(test_ts,xreg=xreg_test) # find best model on the current train set
test_pred[i+1,]<-forecast(model,h=hor)$mean # predict new values
test_pred
test_pred[i,]<-forecast(model,h=hor)$mean # predict new values
test_pred
test_pred<-data.frame(matrix(data=NA,nrow=nrow(test),ncol=ncol(test),dimnames=list(rownames(test),colnames(test)))) # initialize matrix for predictions
test_pred[i,]<-forecast(model,h=hor)$mean # predict new values
test_pred
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
test<-read.csv(paste(dir,'test.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load test set
train
train$date
rownames(train)
as.factor(year(rownames(train))
)
rbind(rownames(train),rownames(test))
rownames(train)
rownames(test)
?rbind
cbind(rownames(train),rownames(test))
c(rownames(train),rownames(test))
max.print
getOption(max.print)
getOption('max.print')
setOption('max.print')=1500
option(max.print=1500)
?option
options(max.print=1500)
c(rownames(train),rownames(test))
dummy_year=model.matrix(~as.factor(year(c(rownames(train),rownames(test)))))
dummy_year
year(c(rownames(train),rownames(test)))
as.factor(year(c(rownames(train),rownames(test))))
?factor
?~
dummy_year=model.matrix(~as.factor(year(c(rownames(train),rownames(test)))))
dummy_year[1]
dummy_year[,1]
dummy_year[,2]
dummy_year[,3]
dummy_year[,4]
dummy_year[,5]
dummy_year[,1]
?model.matrix
dummy_year[,6]
dummy_year[,5]
dummy_year[,0]
as.factor(year(c(rownames(train),rownames(test)))
)
dummy_year[,1]
?fourier
?msts
5/2
5//2
5%2
5%/%2
?expand.grid
?combn
combn(5,2)
?expand.grid
?expand.grid(1:5,1:3)
expand.grid(1:5,1:3)
K=list(5,8)
expand.grid(K)
expand.grid(unlist(K)
)
unlist(K)
unlist(K)%/%2
1:unlist(K)%/%2
?apply
?:
lapply(K%/%2
)
lapply(K%/%2,seq,from=1)
K%/%2
K
K=list(5,8)
K%/%2
lapply(K,function(x) seq(from,x%/%2),from=1)
lapply(K,function(x) seq(from=1,x%/%2),from=1)
?se
?seq
lapply(K,function(x) seq(x%/%2))
expand.grid(lapply(K,function(x) seq(x%/%2)))
K=list(5,8,6)
expand.grid(lapply(K,function(x) seq(x%/%2)))
?dlply
?by
expand.grid(lapply(K,function(x) seq(0,x%/%2)))
?fourier
params=expand.grid(lapply(K,function(x) seq(0,x%/%2))) # all combinations of fourier orders
nrow(params
)
?fourier
library(forecast)
library(lubridate)
?fourier
fourier_order<-function(train,freqs){
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
}
return(param_best)
}
dir<-'C:/Users/SABA/Google Drive/mtsg/data/' # directory containing data
train<-read.csv(paste(dir,'train.csv', sep=''),header=TRUE,row.names='date',sep=',',dec='.') # load train set
train
ts(c(t(train)),frequency = freq)
fourier_order<-function(train,freq,freqs){
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
print(aicc_best)
}
}
return(param_best)
}
fourier_order(train,freq=24,freqs=c(7,365.25))
freq=7
freq=24
freqs=c(7*24,365.25*24)
params<-expand.grid(lapply(freqs,function(x) seq(0,x%/%2))) # all combinations of fourier orders
params
?expand.grid
expand.grid(height = seq(60, 80, 5), weight = seq(100, 300, 50),
sex = c("Male","Female"))
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
max_order=10
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
i=0
unlist(params[i,])
unlist(params[0,])
unlist(params[1,])
unlist(params[20,])
param<-unlist(params[i,]) # combination of orders
i=1
param<-unlist(params[i,]) # combination of orders
is.list(param)
is.vector(param)
freqs=c(7*24,365.25*24)
freqs
is.vector(freqs)
?apply
?vapply
?sapply
?expand.grid
params<-expand.grid(apply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params<-expand.grid(sapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
params
is.vector(freqs)
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
param<-unlist(params[i,]) # combination of orders
?fourier
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
param
i
param<-unlist(params[i,]) # combination of orders
param
params
sapply(freqs,function(x) seq(0,max_order))
lapply(freqs,function(x) seq(0,max_order))
vapply(freqs,function(x) seq(0,max_order))
lapply(freqs,function(x) seq(0,max_order))
params<-expand.grid(lapply(freqs,function(x) seq(0,max_order))) # all combinations of fourier orders
param<-unlist(params[i,]) # combination of orders
param
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
xreg_train
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
seq(max_order)
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
fourier_order<-function(train,freq,freqs,max_order){
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
print(param)
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
}
return(param_best)
}
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
max_order
max_order=2
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
i=1
param<-unlist(params[i,]) # combination of orders
print(param)
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train) # find best arima model
?auto.arima
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE,trace=TRUE) # find best arima model
fit
?auto.arima
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE,trace=TRUE) # find best arima model
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,stepwise=FALSE,trace=TRUE) # find best arima model
fit
arimaorder(fit)
fourier_order(train,freq=7,freqs=c(7*24,365.25*24,max_order=10))
fourier_order(train,freq=7,freqs=c(7*24,365.25*24),max_order=10)
fourier_order<-function(train,freq,freqs,max_order){
params<-expand.grid(lapply(freqs,function(x) seq(max_order))) # all combinations of fourier orders
aicc_best<-Inf # best aicc statistic
param_best<-NULL # best parameters
for (i in 1:nrow(params)){ # for each combination of orders
param<-unlist(params[i,]) # combination of orders
xreg_train<-fourier(msts(train,seasonal.periods=freqs),K=param) # fourier terms for particular multi-seasonal time series
fit=auto.arima(ts(c(t(train)),frequency = freq),xreg=xreg_train,seasonal=FALSE,parallel = TRUE,stepwise=FALSE) # find best arima model
if (fit$aicc<aicc_best){ # if there is an improvement in aicc statistic
param_best<-param # save these orders
aicc_best<-fit$aicc # save new best aicc value
}
print(param)
print(fit$aicc)
}
return(param_best)
}
fourier_order(train,freq=7,freqs=c(7*24,365.25*24),max_order=10)
K=fourier_order(train,freq=24,freqs=c(7*24,365.25*24),max_order=10)
